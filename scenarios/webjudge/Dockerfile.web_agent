FROM mcr.microsoft.com/playwright/python:v1.56.0-jammy

ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV PATH="/root/.local/bin:$PATH"
ENV UV_HTTP_TIMEOUT=300

WORKDIR /app

# Install uv using pip
RUN pip install uv

# Copy dependency files
COPY pyproject.toml uv.lock README.md ./
COPY src src

# Install dependencies using uv (invoking via python module to ensure path resolution)
# --system installs into system python environment (simplifies docker usage)
RUN python3 -m uv sync --frozen --no-dev --no-install-project

# Copy scenarios
COPY scenarios scenarios

# Default command
ENTRYPOINT ["python3", "-m", "uv", "run", "scenarios/webjudge/web_agent.py"]
CMD ["--host", "0.0.0.0"]
EXPOSE 9011
